<template>
    <div class="container">
        <div class="renderCanvas-container">
            <canvas id="renderCanvas" touch-action="none" width="1920" height="1080" tabindex="1"
                    style="opacity: 1;"></canvas>
            <video v-show="cameraF&&srcObjectF" :class="{videoH:WH,videoW:!WH}" autoplay="autoplay" id="video"
                   muted="muted" playsinline="playsinline"></video>
        </div>
        <div id="notSupported" class="hidden">loading...</div>
        <div class="wxtip" id="JweixinTip" :style="'background-image: url(./static/UI/weixin-tip.png);'"></div>
        <div v-show="loadModelF" id="changeSence" :style="'height:'+HeightC+'px;'">
            <div id="camera" v-show="cameraF"><img src="static/UI/tran.png"></div>
            <div id="white"><img src="static/UI/white.png"></div>
            <div id="black"><img src="static/UI/black.png"></div>
        </div>
        <div v-show="loadModelF" id="switchBtn" :style="'height:'+HeightS+'px;'">
            <div style="background: #6a6a6a;">常见准静止锋</div>
            <div>地形准静止锋</div>
        </div>
    </div>
</template>

<script>
    export default {
        data() {
            return {
                canvas: null,
                checked: false,
                sceneChecked: false,
                title: '准静止锋',
                cameraF: false,
                HeightC: 136,
                HeightS: 98,
                hasQG: false,
                loadModelF: true,
                front: 1,
                WH: true,
                srcObjectF: false,
                strData1: window.strData1,
                strData2: window.strData2,

            };
        },
        methods: {
            init() {
                var thiz = this;
                var h = location.hash;
                // 获取摄像头参数
                var loadByHash = () => {

                    if (h && h.indexOf('camera=true') > -1) {
                        this.cameraF = true;
                        this.HeightC = 210;
                    } else {
                        this.cameraF = false;
                        this.HeightC = 136;
                    }
                }
                loadByHash();
                document.title = this.title;
                this.WH = window.innerWidth < window.innerHeight;
                //开启摄像头初始化
                var ua = navigator.userAgent;
                var isMob = /iPhone|iPad|Android/i.test(ua);
                if (/iPhone|iPad/i.test(ua) && /MicroMessenger|QQ/i.test(ua) && this.cameraF) {
                    document.getElementById('JweixinTip').style.display = 'block';
                }

                var exfect = [];
                if (navigator && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.enumerateDevices()
                        .then(function gotDevices(deviceInfos) {
                            for (var i = 0; i !== deviceInfos.length; ++i) {
                                var deviceInfo = deviceInfos[i];
                                if (deviceInfo.kind === 'videoinput') {
                                    exfect.push(deviceInfo.deviceId);
                                }
                            }
                        }).catch(function errorCallback(error) {
                        console.log('navigator.getUserMedia error: ', error);
                    });
                }

                function openCamera(id) {
                    var constraints = {audio: false, video: {deviceId: id}}
                    if (navigator && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        navigator.mediaDevices.getUserMedia(constraints).then(function success(stream) {
                            video.srcObject = stream;
                        });
                    } else {
                        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                        navigator.getUserMedia(constraints, function (stream) {
                            video.srcObject = stream;
                        }, function (err) {
                        });
                    }
                }

                // Launch render loop
                this.canvas = document.getElementById("renderCanvas");
                var engine = new BABYLON.Engine(this.canvas, true, {preserveDrawingBuffer: true, stencil: true});
                var thiz = this;
                window.addEventListener("resize", () => {
                    engine.resize();
                    this.WH = window.innerWidth < window.innerHeight;
                });

                if (!BABYLON.Engine.isSupported()) {
                    //TODO显示webgl不支持信息
                } else {
                    var scene = this.loadCustomScene(this.createScene, engine);
                    if (h && h.indexOf('camera=true') > -1) {
                        scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);
                    } else {
                        scene.clearColor = new BABYLON.Color4(0.95, 0.95, 0.95, 1);
                    }
                  var renderTimes=0;
                    var renderFunction = () => {

                        if (scene) {
                            if (scene.activeCamera) {
                              renderTimes++;
                              if(renderTimes%4!=0)return;
                                scene.render();
                                if (this.cameraF && exfect[this.front] && !this.srcObjectF && isMob || this.cameraF && exfect[0] && !this.srcObjectF) {
                                    console.log("openCamera");
                                    if (isMob) {
                                        openCamera(exfect[this.front], this.front);
                                    } else {
                                        openCamera(exfect[0], 0);
                                    }
                                    this.srcObjectF = true;
                                }
                            }
                            if (scene.useDelayedTextureLoading) {
                                var waiting = scene.getWaitingItemsCount();
                                if (waiting <= 0) {
                                    document.getElementById("notSupported").className = "hidden";
                                }
                            } else if (!thiz.sceneChecked) {
                                var remaining = scene.getWaitingItemsCount();
                                if (remaining === 0) {
                                    thiz.sceneChecked = true;
                                    document.getElementById("notSupported").className = "hidden";
                                }
                            }
                        }
                    };
                    engine.runRenderLoop(renderFunction);
                }
                engine.resize();
            },

            // Render loop
            loadCustomScene(demoConstructor, engine) {
                document.getElementById("notSupported").className = "";
                var scene = demoConstructor(engine);
                if (scene.activeCamera) {
                    scene.activeCamera.attachControl(this.canvas, false);
                }
                scene.executeWhenReady(() => {
                    this.canvas.style.opacity = 1;
                });
                return scene;
            },
            createScene(engine) {
                var jsonstr = [16.4801, -12.6466, 4.5038, 17.3695, -14.9314, 5.1224, 18.4882, -12.1989, 4.5225, 14.0759, -13.7154, 5.044, 15.9002, -15.8513, 5.3264, 10.8735, -16.2969, 5.5247, 11.4056, -17.1006, 6.5094, 13.1243, -16.6719, 5.9899, 6.7022, -15.7202, 6.4099, 11.6111, -15.1021, 5.2626, 18.7303, -13.0533, 5.0452, 12.4839, -17.5164, 6.6285, 14.0309, -18.2138, 7.2622, 15.7717, -17.7693, 5.9595, 9.9747, -18.8334, 8.1798, 2.3538, -15.9199, 7.9339, 3.3028, -19.1127, 8.5431
                    , 16.0314, -14.8559, 8.1527, 17.6932, -14.3789, 6.4477, 10.4595, -19.3529, 9.2864, 5.9506, -18.6655, 8.5734, 3.013, -20.3004, 10.8262, -5.4562, -17.4082, 9.7721, -7.7476, -16.9855, 11.239, 15.7939, -14.6583, 9.7005, 9.8253, -18.6881, 10.402, -2.5969, -18.9613, 10.9877, -8.6737, -13.1707, 13.6707, -1.4477, -17.8146, 12.9638, -23.0496, -14.0341, 13.3961, -22.5299, -12.7455, 14.1991, -16.2794, -13.788, 13.7272, 17.8155, -12.9874, 13.2345, 18.6049, -10.805, 14.8363
                    , 20.2508, -9.9652, 13.4725, 15.9816, -14.5981, 13.2211, 16.4519, -11.063, 15.3252, 7.8213, -16.9231, 14.6813, 3.2325, -11.9753, 13.5093, 11.3884, -11.5465, 14.6485, -19.5528, -9.8101, 14.9476, 20.3681, -6.8395, 15.0669, 22.4137, -5.7963, 13.3914, 17.5792, -6.4694, 15.6171, 6.46, -9.5619, 14.083, -24.0658, -10.1749, 14.948, -25.5743, -5.467, 15.9151, -20.0873, -6.2502, 15.6955, 17.0704, 5.3179, 15.8062, 16.5568, 7.8882, 14.9986, 22.158, 2.0619, 13.139
                    , 3.668, 2.3118, 14.1342, 3.5883, 4.7394, 14.1417, 5.9217, 4.8998, 13.9536, 8.5092, 0.3855, 13.7254, 4.8707, 0.2334, 14.5877, -19.2315, 0.0336, 15.4341, -23.145, 2.4255, 15.6637, -18.5903, 2.9122, 15.2459, 20.1513, 12.5114, 15.0284, 20.2656, 14.1775, 14.1263, 20.9941, 12.3487, 13.7883, 17.1923, 12.1832, 15.9265, 19.4579, 15.1345, 15.4432, 4.7376, 12.4581, 15.3459, 5.9944, 14.1694, 13.8143, 7.7969, 13.9554, 13.4179, -17.4255, 12.1935, 14.9
                    , -20.9152, 13.8873, 14.8215, -14.5566, 15.024, 13.9054, 19.7578, 14.6434, 12.897, 13.596, 15.3202, 13.7655, 17.5558, 15.6936, 14.3943, 13.4775, 15.352, 13.6911, 13.5958, 15.3631, 13.7461, -17.1079, 17.3619, 13.8103, -9.1424, 16.7278, 12.2308, 19.0157, 14.9584, 8.3496, 16.881, 17.2789, 7.5667, 19.2954, 13.8955, 6.4425, 15.6325, 18.1317, 9.3991, 13.444, 18.4711, 7.7646, 7.7279, 19.1898, 9.0542, 12.2774, 19.0344, 7.62, -14.5913, 18.0754, 12.249
                    , -4.3195, 18.6962, 9.1664, -1.5018, 18.2875, 10.2106, 17.5519, 16.2693, 5.9581, 18.7129, 14.6562, 4.9696, 14.6986, 17.9288, 6.9773, 16.2912, 16.8586, 6.0967, 8.8766, 20.0004, 7.6592, 5.383, 18.1671, 7.1518, 11.5394, 18.5223, 6.7476, 17.3407, 14.05, 4.0597, 18.6421, 13.013, 3.738, 17.6543, 15.6267, 5.2307, 14.6699, 17.237, 6.1022, 12.6515, 16.6328, 5.8124, 15.1149, 15.2249, 4.7712, 9.4389, 17.0512, 6.814, 17.3667, 11.7247, 3.1498
                    , 18.7756, 11.1721, 3.2013, 15.3594, 12.5971, 3.6166, 12.7859, 13.6909, 4.9868, 8.8799, 14.6486, 6.6256, 18.9733, 8.2318, 2.7984, 17.721, 4.5609, 2.6624, 18.919, 4.3127, 2.7195, 17.5781, 8.5815, 2.6319, 16.0206, 4.8766, 2.9228, 15.6723, 9.1491, 2.868, 13.2632, 4.8787, 4.1709, 8.7172, 10.0296, 5.6827, 13.1251, 9.8355, 4.105, 17.5775, -0.5741, 2.5226, 18.4341, -5.5838, 3.2455, 18.7099, -0.7502, 2.5382, 14.8466, -5.973, 4.1009
                    , 16.0641, -7.5701, 3.9918, 17.4149, -5.689, 3.3174, 13.1135, -0.1822, 4.2572, 15.7135, -0.3504, 2.9521, 7.967, -0.2141, 5.9038, 12.497, -6.301, 5.0376, 18.2517, -8.3171, 3.7373, 17.1384, -8.6337, 3.9446, 11.9024, -10.7243, 5.0976, 14.0759, -13.7154, 5.044, 14.4806, -9.7146, 4.6095, 7.4151, -10.0557, 5.7551, 11.6111, -15.1021, 5.2626, 8.8799, 14.6486, 6.6256, 5.383, 18.1671, 7.1518, 2.628, 14.8692, 7.6624, 7.967, -0.2141, 5.9038
                    , 2.8857, 4.1391, 7.7684, 2.6815, -0.0394, 7.9618, 7.4151, -10.0557, 5.7551, 1.3601, -5.0005, 8.3169, 0.4293, -10.7748, 8.4615, 7.4151, -10.0557, 5.7551, -4.3195, 18.6962, 9.1664, -7.6535, 14.7224, 9.7961, -1.9086, 0.8997, 9.0273, -7.3669, -4.9771, 9.7132, -9.9185, -10.0373, 9.8183, -14.2525, 17.7073, 11.5186, -15.5562, 15.5573, 10.9632, -15.3283, 12.9094, 10.3488, -25.4981, 8.6029, 14.4454, -18.4634, 4.2993, 11.6952, -17.4588, -4.6735, 10.7798
                    , -19.498, -10.2672, 11.0065, -15.7393, -16.3295, 11.5078, -23.3629, 12.8492, 13.5239, -26.8933, 12.5147, 14.7045, -28.3772, 11.3112, 14.6019, -24.7341, 4.7029, 12.5943, -21.7853, -2.2085, 12.0689, -26.4388, -4.1868, 13.1132, -26.2064, -9.2935, 12.6437, -26.3027, -11.6436, 13.4496, 18.7756, 11.1721, 3.2013, 19.3327, 13.0602, 4.2157, 18.6421, 13.013, 3.738, 18.919, 4.3127, 2.7195, 19.8771, 7.9728, 3.2599, 18.9733, 8.2318, 2.7984, 18.4341, -5.5838, 3.2455
                    , 19.6766, -5.6036, 3.7362, 19.5375, -0.7661, 3.0013, 18.4341, -5.5838, 3.2455, 18.2517, -8.3171, 3.7373, 19.0066, -7.1485, 3.6937, 19.6769, 10.9076, 3.6257, 19.5458, 12.9672, 4.9135, 19.705, 3.8902, 3.1837, 20.5153, 7.1789, 3.9575, 20.6255, -5.5785, 4.2878, 20.0146, -0.5375, 3.6217, 19.9251, -9.5283, 4.6724, 19.3561, -8.7211, 4.125, 19.2954, 13.8955, 6.4425, 21.2083, 10.3861, 7.097, 19.0157, 14.9584, 8.3496, 21.559, 2.6082, 5.921
                    , 21.4941, 3.3196, 6.8761, 20.9584, 5.9674, 4.9318, 20.4555, -0.0643, 4.6401, 21.7524, -1.6421, 7.0653, 19.5808, -9.8471, 8.2774, 20.4077, -10.0622, 5.7509, 19.0157, 14.9584, 8.3496, 21.0873, 10.5608, 9.1652, 19.3196, 14.9818, 10.7197, 21.3929, 4.1425, 8.544, 21.7456, 5.8159, 6.9281, 21.6167, -1.1152, 7.502, 21.5029, 3.0226, 8.5246, 19.4493, -9.6066, 10.1387, -25.8771, -13.0586, 14.01, -26.0293, -12.7315, 14.5312, -26.6837, -10.1786, 14.9491
                    , -29.777, 0.0512, 15.7759, -34.0669, 3.9634, 15.7998, -28.9855, 3.2521, 15.5477, -33.3846, 7.8593, 16.0643, -28.0151, 7.435, 15.6259, -27.5955, 10.2772, 15.6555, -30.0787, 11.6513, 16.01, -26.646, 12.0464, 15.2859, -26.8933, 12.5147, 14.7045, -30.0787, 11.6513, 16.01, -32.0081, 10.458, 16.1779, -29.7077, 4.4639, 13.8565, -33.3846, 7.8593, 16.0643, -34.0669, 3.9634, 15.7998, -30.5033, -5.0072, 13.7723, -30.5926, -9.6636, 15.4925, -29.118, -9.2302, 13.6138
                    , -29.3612, -5.4573, 16.182, -23.2943, 11.0963, 15.5508, -26.8933, 12.5147, 14.7045, -20.9785, 15.3095, 13.2054, -14.2525, 17.7073, 11.5186, -20.9785, 15.3095, 13.2054, -24.9129, 10.6529, 13.9023, -29.033, 8.7651, 14.3764, -29.4774, -12.2063, 15.3093, -30.5926, -9.6636, 15.4925, -26.7741, -7.786, 15.5528, 11.9046, -17.5072, 11.0843, 16.5265, -14.1674, 11.492, 2.6045, -17.6021, 13.5381, -2.4359, -15.302, 13.6576, -8.7352, -10.3344, 14.0723, -3.2691, -12.2876, 13.6618
                    , -1.7381, -2.8747, 15.0258, -6.8435, -0.0131, 15.1612, -1.1848, -0.0131, 15.0646, 10.9658, 11.443, 15.7326, 4.9903, 9.0176, 13.7836, 4.5606, 10.133, 14.5234, -6.9955, 3.7754, 16.0844, -7.0309, 8.1845, 15.2024, -1.6676, 4.3982, 14.7682, 13.4843, 15.3207, 13.7018, 11.2568, 15.1881, 13.1053, 19.3196, 14.9818, 10.7197, 13.3667, 17.5345, 12.2684, 16.6083, 16.7977, 12.4532, -4.6374, 15.7701, 13.1627, -1.33, 15.8887, 11.1795, 1.9656, 15.5859, 12.6546
                    , 21.1574, 11.6379, 11.9432, 19.7578, 14.6434, 12.897, 22.0674, 7.8588, 9.9206, 21.5996, 6.1134, 7.7838, 21.6696, -3.6991, 8.5637, 22.1604, -0.0131, 11.1356, 21.4027, -0.0131, 8.6281, 19.9288, -9.7963, 12.0989, -13.5995, -14.8289, 14.0199, -12.4985, 13.4014, 14.643, -9.1281, 15.5489, 13.5743, 5.0469, 18.2644, 9.2914, 19.5458, 12.9672, 4.9135, 19.3327, 13.0602, 4.2157, 20.5527, 9.4969, 5.535, 19.2954, 13.8955, 6.4425, 20.3746, 2.8987, 3.937
                    , 21.3358, -5.1653, 6.3465, -15.1755, -9.3244, 15.4068, -13.9657, -2.9757, 15.1806, -13.1678, 0.1496, 15.2015, -12.9595, 3.5999, 15.2415, -18.3523, 6.279, 15.2115, -13.8734, 7.5637, 14.6113, 21.7685, 9.1229, 12.4806, 12.672, 8.3147, 14.5902, -1.6673, 4.3834, 14.7659, -1.6663, 4.3837, 14.7659, -21.7031, 5.6562, 15.5412, 17.8669, -11.2242, 4.1731, 14.0759, -13.7154, 5.044, 16.4801, -12.6466, 4.5038, 7.5555, -5.6219, 6.1701, -9.3987, -1.1158, 9.6301
                    , -16.4988, -0.5387, 11.0708, 17.8669, -11.2242, 4.1731, 21.8237, -4.5383, 8.1583, -33.1806, -5.4639, 15.9533, -33.6604, -0.5144, 15.9011, -31.0109, -0.3655, 13.9187, -34.0669, 3.9634, 15.7998, -33.6604, -0.5144, 15.9011, -27.3181, 1.4303, 15.9212, -25.037, -0.0248, 15.8251, -26.1026, -0.4493, 13.0322, -1.6676, 4.3833, 14.7659, 22.158, 2.0619, 13.139, 22.1918, -0.0131, 13.0948, 20.1857, -2.9115, 16.1176, 19.5683, 0.8681, 15.8268, 22.1918, -0.0131, 13.0948
                    , 8.0752, -1.146, 14.5979, -23.7747, -2.8198, 15.8226, -19.4767, -2.8521, 15.5102, 8.0963, 4.6968, 5.0724, 8.7172, 10.0296, 5.6827, 2.2399, 11.3422, 7.8379, -9.3213, 10.0296, 9.0646, 18.7099, -0.7502, 2.5382, 20.5289, 1.6234, 4.6871, -33.6604, -0.5144, 15.9011, -33.1806, -5.4639, 15.9533, -3.0164, -8.351, 13.8914, -8.4362, -7.3962, 14.4121, 22.4137, -5.7963, 13.3914, 20.2508, -9.9652, 13.4725, -9.0584, 3.1577, 10.4648, -30.5926, -9.6636, 15.4925
                    , -0.3027, -12.2958, 13.4402, 15.4301, -6.1795, 15.5648, 11.2811, -7.7438, 14.6858, 11.1234, -5.0965, 15.2069, 5.4955, -4.8259, 15.8662, 7.1727, -4.0767, 16.0553, 14.7071, 0.4576, 15.0889, 12.7556, 6.5142, 14.6025, 12.6173, 11.6446, 15.5635, 19.3196, 14.9818, 10.7197, 14.9651, -14.9801, 13.8483, 4.9268, -17.1406, 13.7988, 1.8466, -15.3628, 14.3252, 19.7578, 14.6434, 12.897, 20.9941, 12.3487, 13.7883, 20.2656, 14.1775, 14.1263, 22.1301, 3.2593, 11.1199
                    , 21.7685, 9.1229, 12.4806, 22.5471, -5.0892, 11.3682, 20.2508, -9.9652, 13.4725, 8.8421, 5.0996, 14.1071, 5.4191, 8.1009, 13.5292, 5.2645, -1.6623, 15.3647, -7.57, -2.617, 14.342, -14.714, -6.6297, 16.1775, -11.1582, -13.6267, 13.8495, -18.6651, 9.2498, 15.2916, -13.62, 10.303, 14.8291, -0.1451, -7.2619, 14.4198, 1.0027, -2.4342, 15.5832, 1.4174, 0.0885, 15.2597, -23.7312, 8.282, 15.7261, -32.0081, 10.458, 16.1779, -33.3846, 7.8593, 16.0643
                    , 8.8799, 14.6486, 6.6256, 8.7172, 10.0296, 5.6827, 18.9733, 8.2318, 2.7984, 20.1898, 10.1884, 4.3412, 21.7685, 9.1229, 12.4806, 20.9941, 12.3487, 13.7883, 19.7223, 10.2437, 14.9382, -7.2049, 11.019, 14.3854, -2.3822, 8.6632, 15.5314, -1.7815, 10.9979, 14.5178, -6.1597, 13.871, 13.6586, 2.8732, 13.0966, 13.8277, -0.2796, 13.116, 13.0864, 0.5519, 8.5121, 14.1039, 11.2192, -17.2584, 13.9124, 12.2286, -17.358, 13.572, 11.8774, 0.4251, 14.094
                    , 12.5038, 5.1968, 14.95, 14.4246, -11.5379, 14.9356, 13.1238, -11.525, 14.6182, 10.0992, -4.8271, 15.6121, 17.8669, -11.2242, 4.1731, 22.1918, -0.0131, 13.0948, -14.2525, 17.7073, 11.5186, 19.5458, 12.9672, 4.9135, 19.3327, 13.0602, 4.2157, 7.5555, -5.6219, 6.1701, 11.6111, -15.1021, 5.2626, 14.0759, -13.7154, 5.044, 6.7022, -15.7202, 6.4099, 11.6111, -15.1021, 5.2626, 8.8799, 14.6486, 6.6256, 9.4389, 17.0512, 6.814, 5.383, 18.1671, 7.1518
                    , 7.967, -0.2141, 5.9038, 8.0963, 4.6968, 5.0724, 7.4151, -10.0557, 5.7551, 7.4151, -10.0557, 5.7551, 5.383, 18.1671, 7.1518, -4.3195, 18.6962, 9.1664, -4.3195, 18.6962, 9.1664, -20.9785, 15.3095, 13.2054, 18.7756, 11.1721, 3.2013, 18.919, 4.3127, 2.7195, 18.7099, -0.7502, 2.5382, 18.4341, -5.5838, 3.2455, 18.4341, -5.5838, 3.2455, 19.2954, 13.8955, 6.4425, 19.0157, 14.9584, 8.3496, -32.0081, 10.458, 16.1779, -30.0787, 11.6513, 16.01
                    , -33.3846, 7.8593, 16.0643, -33.1806, -5.4639, 15.9533, -26.8933, 12.5147, 14.7045, -20.9785, 15.3095, 13.2054, 19.3196, 14.9818, 10.7197, 7.5555, -5.6219, 6.1701, 16.4801, -12.6466, 4.5038, 16.4801, -12.6466, 4.5038, 7.967, -0.2141, 5.9038, 18.2517, -8.3171, 3.7373, 18.2517, -8.3171, 3.7373, 17.8669, -11.2242, 4.1731, -34.0669, 3.9634, 15.7998, 22.158, 2.0619, 13.139, 22.1918, -0.0131, 13.0948, 8.0963, 4.6968, 5.0724, 8.7172, 10.0296, 5.6827
                    , 18.919, 4.3127, 2.7195, 18.7099, -0.7502, 2.5382, -33.6604, -0.5144, 15.9011, 22.4137, -5.7963, 13.3914, -30.5926, -9.6636, 15.4925, -30.5926, -9.6636, 15.4925, 19.7578, 14.6434, 12.897, 20.9941, 12.3487, 13.7883, 22.158, 2.0619, 13.139, 21.7685, 9.1229, 12.4806, 22.4137, -5.7963, 13.3914, -32.0081, 10.458, 16.1779, 8.8799, 14.6486, 6.6256, 18.7756, 11.1721, 3.2013, 18.9733, 8.2318, 2.7984, 21.7685, 9.1229, 12.4806]

                var jsonstr2 = [34.5113, 12.914, 15.7182, 34.2016, 14.6823, 14.5161, 36.6363, 11.9277, 14.6094, 31.3823, 15.0069, 16.3295, 32.325, 15.802, 14.9351, 26.2353, 16.4256, 15.2927, 24.0139, 17.3114, 13.2802, 28.0677, 16.9446, 14.657, 18.1846, 12.5208, 14.2514, 17.0159, 14.5755, 14.0139, 19.8611, 14.3517, 14.1973, 36.2481, 12.9281, 14.0045, 23.669, 17.3091, 12.2539, 28.0201, 16.6355, 12.722, 29.1094, 16.4928, 13.5299, 19.0533, 17.4301, 12.1812, 21.7848, 17.4553, 11.3773
                    , 10.9714, 12.7402, 13.1354, 10.5584, 14.4256, 12.5473, 12.344, 14.6454, 12.7907, 33.3725, 14.1474, 12.2821, 33.9983, 14.1111, 12.9811, 27.0466, 16.7846, 11.7938, 15.9978, 17.3104, 11.8492, 19.8032, 17.4361, 10.6905, 5.7369, 13.5438, 12.1345, 6.6101, 17.0265, 10.8641, 10.6159, 16.5129, 11.5637, 26.1364, 16.924, 10.8843, 32.6448, 14.2758, 9.9702, 32.7875, 14.1814, 11.5835, 18.0158, 17.2987, 9.9016, 25.9715, 17.1934, 9.2248, 8.4799, 17.5136, 9.6068
                    , 7.6968, 16.5583, 7.415, 17.8174, 17.0371, 8.2624, -10.386, 14.7525, 7.9254, -11.0296, 14.8007, 6.9074, -4.5469, 15.3308, 7.8567, 32.6892, 13.4973, 7.1974, 31.4929, 11.5023, 5.5247, 36.2801, 10.9312, 6.7305, 28.2328, 15.0948, 6.4939, 25.4622, 12.6332, 4.9451, 21.6358, 16.01, 5.4645, 15.1868, 13.1029, 5.5033, -9.3072, 11.0002, 5.5604, 35.6559, 7.1414, 4.663, 40.496, 6.3347, 6.6255, 30.5871, 6.7544, 4.0062, 19.3239, 10.4593, 6.4144
                    , -12.6219, 11.9408, 6.3441, -13.0014, 7.1005, 6.4293, 32.815, -5.8393, 4.3038, 32.412, -8.6547, 4.8426, 37.4082, -5.1986, 6.7758, 21.9884, -0.4365, 6.6171, 22.3048, -5.6002, 5.2335, 29.6786, -0.5155, 3.7094, 9.3218, 0, 6.3002, 8.9685, -4.816, 6.1203, -13.2858, -0.1509, 6.3724, -9.3957, -2.2038, 6.1122, -8.2711, 1.6764, 5.711, 34.9103, -11.88, 4.9108, 37.321, -13.2285, 6.1926, 37.7033, -9.3448, 6.4929, 33.0344, -13.3591, 4.1694
                    , 28.6543, -18.0572, 5.155, 35.961, -16.1401, 4.7363, 2.9979, -19.3486, 7.1091, 14.973, -21.3694, 6.8748, 7.6151, -12.5176, 6.0499, -8.5897, -11.0002, 6.7101, -9.0532, -15.6053, 7.5846, -1.9296, -17.0601, 7.6827, 36.9642, -13.7483, 7.3417, 34.6413, -17.4168, 6.0294, 28.4977, -18.1006, 5.1669, 28.6583, -18.1196, 5.1703, -2.5786, -17.5898, 9.1823, 8.6104, -20.7977, 9.7816, 35.5444, -14.2287, 10.6956, 33.6317, -17.8871, 11.0247, 36.4995, -13.2254, 12.5718
                    , 32.6022, -19.3925, 9.3803, 27.6897, -20.2292, 10.524, 22.7021, -21.924, 9.5284, 23.6651, -20.7609, 10.816, -1.4263, -16.9995, 10.1832, 9.3446, -17.4681, 11.6534, 34.9069, -16.8554, 12.88, 36.7981, -14.3738, 14.0384, 29.9504, -20.1021, 11.4668, 33.5738, -18.5471, 12.641, 18.0337, -19.3899, 11.93, 18.6024, -17.2703, 12.7624, 21.7138, -18.7246, 12.5751, 36.5532, -13.6029, 15.3823, 38.8538, -12.0042, 14.9873, 35.4634, -15.9858, 13.7556, 31.2018, -19.3308, 12.4989
                    , 28.3042, -18.0782, 13.0988, 32.5547, -17.5598, 13.5577, 21.6805, -16.3253, 13.2632, 24.4433, -17.3951, 13.1225, 38.5514, -11.8152, 15.6065, 36.9135, -9.8118, 16.1805, 38.6439, -9.0184, 15.9258, 34.2559, -10.76, 16.4875, 33.3963, -15.5971, 14.7045, 30.3114, -11.0017, 16.3401, 26.2423, -13.3901, 14.3013, 23.27, -9.9092, 14.6131, 26.8342, -10.1174, 15.0222, 35.7577, -4.9411, 16.6321, 37.306, -4.6571, 16.3428, 33.3725, -5.1862, 16.2922, 27.158, -3.5622, 15.2156
                    , 36.9767, 0.1171, 15.2527, 36.1675, 4.8478, 15.1805, 37.9607, 0.0075, 15.2752, 32.6605, 6.6708, 16.0638, 34.0446, 7.5695, 15.9734, 35.2958, 5.3657, 15.343, 30.834, 0.0013, 14.803, 34.5589, 0.3248, 14.9304, 26.9313, 0.2466, 15.0264, 22.5835, 5.6944, 15.0075, 26.6736, 7.1125, 16.3765, 36.8102, 7.7574, 15.1996, 35.4163, 8.3219, 15.6207, 29.219, 12.2026, 17.0273, 31.3823, 15.0069, 16.3295, 31.1828, 9.5334, 16.8545, 21.6671, 11.0396, 15.2986
                    , 22.9021, 13.9787, 15.1236, 26.3379, 12.0562, 16.8626, 19.1813, -11.7626, 14.0441, 16.5327, -15.0322, 13.3129, 14.8624, -12.5139, 14.4053, 18.3303, 0.6784, 15.794, 15.3663, -3.2341, 15.9059, 14.539, 0.7754, 15.326, 17.6807, 4.8839, 14.2915, 12.3451, 9.212, 14.5121, 16.947, 10.1798, 14.4016, 15.0698, 12.3849, 13.908, 8.9906, -14.9258, 12.2043, 4.37, -11.3603, 12.2612, 7.7027, -11.7267, 12.8052, 13.0423, 0.263, 15.0331, 9.9725, 9.6102, 13.975
                    , 7.5741, 4.9196, 12.4674, 7.6651, 9.6846, 13.5178, 9.0337, 12.7115, 13.0713, -1.4263, -16.9995, 10.1832, -1.2591, -12.2297, 11.6217, 0.4506, -11.6985, 11.8785, 2.2791, -11.1304, 12.0838, -1.1237, -4.3957, 13.2829, 1.4768, -3.4025, 13.7279, 3.6246, 9.8521, 12.2592, -0.7499, 5.478, 10.9592, -0.5631, 10.3414, 11.6061, 2.0758, 14.0574, 11.3925, -9.5226, -12.7111, 9.6308, -12.6154, -13.0883, 8.2281, -14.1018, -10.4148, 8.3658, -8.997, -9.7249, 10.7856
                    , -9.1315, -5.7032, 10.9395, -3.555, -5.3242, 12.4861, -8.1723, 6.6943, 10.1536, -13.3183, 4.7411, 10.132, -12.5044, 8.5191, 9.4288, -8.4672, 10.6885, 10.0348, -13.1236, 12.2283, 8.0183, 38.5514, -11.8152, 15.6065, 39.3715, -8.7304, 15.3829, 38.8538, -12.0042, 14.9873, 38.6439, -9.0184, 15.9258, 38.0602, -4.4803, 15.7387, 36.1675, 4.8478, 15.1805, 37.0228, 4.5811, 14.5019, 37.9607, 0.0075, 15.2752, 36.1675, 4.8478, 15.1805, 36.8102, 7.7574, 15.1996
                    , 37.0783, 6.3003, 14.8408, 38.8538, -12.0042, 14.9873, 39.3495, -8.5357, 14.5688, 38.4568, -12.1693, 14.2074, 38.2859, -0.0714, 14.8889, 37.1897, 4.1503, 13.8737, 38.2454, -0.26, 14.2842, 37.6005, 8.6825, 13.6354, 37.5766, 7.9347, 14.3542, 36.4995, -13.2254, 12.5718, 39.6333, -10.1066, 11.8061, 35.5444, -14.2287, 10.6956, 37.922, -4.0134, 14.1014, 38.788, -5.6812, 12.5206, 39.3809, -8.5835, 13.55, 38.0519, -0.7625, 13.5972, 37.9721, 1.2295, 12.4103
                    , 37.9918, -2.3654, 13.2107, 37.6642, 10.1175, 12.0086, 37.4651, 9.5434, 12.6466, 35.5444, -14.2287, 10.6956, 39.3004, -10.4755, 9.8906, 36.1669, -14.3795, 8.8809, 38.8866, -6.8481, 10.5741, 37.7538, -0.8644, 11.5751, 37.4334, -4.2336, 10.7652, 38.4485, 11.3436, 10.2283, 37.8436, 10.6544, 11.4033, -13.2677, 13.6544, 7.4529, -13.7134, 13.5695, 6.9985, -14.6802, 11.6738, 6.7484, -17.9007, -0.0631, 7.1649, -17.9098, -5.0955, 7.4635, -17.5538, -4.8, 6.9897
                    , -15.7678, -9.5018, 7.6776, -15.2322, -9.6331, 7.2145, -14.1718, -12.0477, 7.8211, -13.0902, -12.8061, 7.6713, -12.6154, -13.0883, 8.2281, -14.1718, -12.0477, 7.8211, -15.7678, -9.5018, 7.6776, -16.8565, -5.4855, 8.1715, -15.7678, -9.5018, 7.6776, -17.9098, -5.0955, 7.4635, -15.4986, 9.8435, 8.3324, -18.711, 6.2105, 7.8002, -16.4305, 10.5089, 7.4096, -17.5334, 6.7852, 7.2662, -14.8315, -6.2098, 6.3691, -12.4031, -10.7103, 6.8447, -12.6154, -13.0883, 8.2281
                    , -7.8418, -16.1841, 9.182, -5.6204, -13.5846, 10.6727, -7.8418, -16.1841, 9.182, -13.8266, -6.023, 9.5509, -18.3745, 5.858, 8.8538, -12.2467, 9.7131, 9.1473, -14.7979, 12.9114, 7.1874, -16.4305, 10.5089, 7.4096, -14.7408, 9.5521, 6.7014, 27.0294, 16.3383, 7.7497, 32.9571, 14.0365, 8.3756, 19.9357, 16.8085, 6.5882, 14.1328, 16.5493, 5.1942, 7.1742, 13.7248, 6.0165, 1.39, 16.1101, 8.2148, -3.8822, 12.0568, 6.4458, 7.5698, 9.133, 5.195
                    , -2.9443, 0, 6.029, 24.6917, -12.5484, 5.7886, 8.9663, -4.8319, 6.1199, -3.0034, -3.4246, 7.148, -1.3457, -11.8543, 6.4818, 21.1569, -17.167, 6.0186, 28.5062, -18.0577, 5.1625, 33.631, -18.4606, 7.4388, 36.1669, -14.3795, 8.8809, 28.5751, -20.8875, 6.2312, 18.4706, -21.9929, 10.0507, 36.9642, -13.7483, 7.3417, 38.6899, -9.4106, 8.057, 39.2635, 5.3285, 9.9382, 38.9668, 0.2052, 8.3518, 37.754, -1.3288, 9.8879, 38.5835, 11.3468, 8.6271
                    , 30.1021, 16.3627, 14.1748, 26.2246, 17.2864, 13.4875, 29.5825, 16.4308, 13.8491, 15.3629, 16.8262, 12.7472, 12.6869, 17.4465, 10.5, 2.0262, 16.6939, 9.7994, 17.1062, -20.2992, 10.9099, 38.4568, -12.1693, 14.2074, 25.8005, -19.4878, 12.3982, 36.4995, -13.2254, 12.5718, 38.1327, -4.3351, 14.9767, 37.4097, 3.561, 13.1211, -3.4762, 7.4145, 5.9028, 8.9668, -4.8155, 6.1204, 29.4508, 7.9551, 17.1562, 36.2582, 10.8873, 15.2277, 31.3823, 15.0069, 16.3295
                    , 34.5113, 12.914, 15.7182, 12.9271, 4.0981, 13.6952, 8.5422, -1.2776, 14.3717, 10.3748, 4.4898, 12.8734, 11.6797, -0.2035, 14.7478, 2.1807, 1.2079, 12.0087, -1.9181, 0.2809, 11.1232, -5.7504, -0.5857, 11.0176, 36.2582, 10.8873, 15.2277, 38.5858, 4.3266, 11.2657, -18.711, 6.2105, 7.8002, -19.1322, 0.5351, 7.5025, -17.8263, 0.1526, 8.2525, -17.9098, -5.0955, 7.4635, -19.1322, 0.5351, 7.5025, -16.4648, -2.9779, 6.652, -13.8342, -1.8707, 9.202
                    , 37.868, -4.9884, 8.5273, 38.9409, 0.2519, 6.485, 37.4082, -5.1986, 6.7758, 36.7048, 3.1748, 4.6456, 19.8819, 4.4511, 6.3359, -9.0427, 6.2133, 5.5838, 22.5453, -1.395, 15.9783, 11.1147, -12.1019, 13.6213, 11.7943, -2.21, 14.9871, -10.3271, 3.0891, 10.0716, 37.9607, 0.0075, 15.2752, -19.1322, 0.5351, 7.5025, 40.496, 6.3347, 6.6255, 36.2801, 10.9312, 6.7305, 5.4609, -0.0737, 13.2936, 4.2006, -2.5834, 13.7833, 2.8812, -2.9802, 13.7406
                    , -8.3952, 2.0226, 9.7886, -5.3757, 5.5163, 10.0477, -16.4305, 10.5089, 7.4096, 35.6774, -0.8948, 4.007, 36.1669, -14.3795, 8.8809, 37.321, -13.2285, 6.1926, 36.9642, -13.7483, 7.3417, 37.4082, -5.1986, 6.7758, 37.7033, -9.3448, 6.4929, 39.9415, 5.8288, 8.3638, 36.2801, 10.9312, 6.7305, 12.7592, -15.3398, 12.7765, 6.0523, 9.5206, 12.7899, 7.4721, 13.0423, 12.7752, 10.438, 15.2604, 12.2203, 20.9148, 12.7061, 14.7981, 22.9021, 13.9787, 15.1236
                    , 21.6671, 11.0396, 15.2986, 22.5835, 5.6944, 15.0075, 21.6671, 11.0396, 15.2986, 22.2406, 0.5785, 15.9005, 18.9004, -2.3287, 16.3461, 23.27, -9.9092, 14.6131, 23.3579, -13.3949, 14.0111, 23.27, -9.9092, 14.6131, 23.6836, -15.2629, 13.6341, 25.99, -15.5271, 13.7551, 29.4054, -15.16, 14.344, 13.4857, 16.0544, 12.6956, 18.8154, 16.045, 13.6806, 21.4298, 15.8007, 14.0086, 22.9021, 13.9787, 15.1236, 24.5455, 15.3018, 15.1958, 24.5455, 15.3018, 15.1958
                    , 27.9184, 12.2813, 17.0482, 28.1385, 7.6204, 16.7899, 28.6378, 0.1278, 14.8757, 28.7974, -4.3384, 15.3013, 28.7818, -10.559, 15.6813, 28.3165, -13.3815, 14.713, 20.492, -19.9336, 11.7901, 25.0722, 17.2747, 12.8878, 21.5284, 17.4134, 12.4402, 20.8783, 16.9501, 13.1494, 18.416, 17.0117, 13.0001, 16.1898, 16.2319, 13.4556, 14.519, 14.7554, 13.4724, 12.8531, 12.5764, 13.4229, 11.5911, 4.3031, 13.2325, 11.1049, 9.4232, 14.179, 15.1803, -19.3919, 11.4359
                    , 14.7645, -17.9642, 12.1845, 4.1995, 5.4374, 11.8937, 22.7339, 16.6494, 14.0008, 26.2353, 16.4256, 15.2927, 30.4392, -5.1647, 15.5484, 21.6805, -16.3253, 13.2632, 20.1679, -14.2598, 13.6011, 18.6024, -17.2703, 12.7624, 14.7645, -17.9642, 12.1845, 9.3446, -17.4681, 11.6534, 3.3572, -11.2489, 12.1685, 9.3446, -17.4681, 11.6534, 5.9395, 5.1704, 12.2934, -6.0273, 11.3181, 11.1246, -2.8616, 14.9401, 10.4903, 36.2582, 10.8873, 15.2277, 38.9409, 0.2519, 6.485
                    , 38.4568, -12.1693, 14.2074, 23.3579, -13.3949, 14.0111, 22.2406, 0.5785, 15.9005, 26.2353, 16.4256, 15.2927, 31.3823, 15.0069, 16.3295, 20.9148, 12.7061, 14.7981, -1.4263, -16.9995, 10.1832, 9.3446, -17.4681, 11.6534, -1.4263, -16.9995, 10.1832, -1.4263, -16.9995, 10.1832, -7.8418, -16.1841, 9.182, 38.5514, -11.8152, 15.6065, 38.6439, -9.0184, 15.9258, 38.6439, -9.0184, 15.9258, 37.306, -4.6571, 16.3428, 37.9607, 0.0075, 15.2752, 36.1675, 4.8478, 15.1805
                    , 38.8538, -12.0042, 14.9873, 36.4995, -13.2254, 12.5718, 35.5444, -14.2287, 10.6956, -14.1718, -12.0477, 7.8211, -15.7678, -9.5018, 7.6776, -12.6154, -13.0883, 8.2281, -1.4263, -16.9995, 10.1832, -7.8418, -16.1841, 9.182, 36.9642, -13.7483, 7.3417, 34.5113, 12.914, 15.7182, 34.5113, 12.914, 15.7182, 36.8102, 7.7574, 15.1996, 36.8102, 7.7574, 15.1996, 36.2582, 10.8873, 15.2277, -18.711, 6.2105, 7.8002, -17.9098, -5.0955, 7.4635, 38.9409, 0.2519, 6.485
                    , 38.9409, 0.2519, 6.485, 22.2406, 0.5785, 15.9005, 37.306, -4.6571, 16.3428, 37.9607, 0.0075, 15.2752, -19.1322, 0.5351, 7.5025, 40.496, 6.3347, 6.6255, -16.4305, 10.5089, 7.4096, -18.711, 6.2105, 7.8002, -16.4305, 10.5089, 7.4096, 36.1669, -14.3795, 8.8809, 37.7033, -9.3448, 6.4929, 37.321, -13.2285, 6.1926, 37.4082, -5.1986, 6.7758, 40.496, 6.3347, 6.6255, 36.2801, 10.9312, 6.7305, 21.6671, 11.0396, 15.2986, 22.5835, 5.6944, 15.0075
                    , 22.5835, 5.6944, 15.0075, 22.5453, -1.395, 15.9783, 22.5453, -1.395, 15.9783, 23.27, -9.9092, 14.6131, 22.9021, 13.9787, 15.1236, 24.5455, 15.3018, 15.1958, 24.5455, 15.3018, 15.1958, 26.2353, 16.4256, 15.2927, 23.3579, -13.3949, 14.0111, 23.6836, -15.2629, 13.6341, 21.6805, -16.3253, 13.2632, 21.6805, -16.3253, 13.2632, 18.6024, -17.2703, 12.7624, 18.6024, -17.2703, 12.7624, 14.7645, -17.9642, 12.1845, 14.7645, -17.9642, 12.1845, 9.3446, -17.4681, 11.6534
                    , 9.3446, -17.4681, 11.6534]


                BABYLON.Effect.ShadersStore["customVertexShader"] =
                    "precision highp float;\r\n" +
                    "attribute vec3 position;\r\n" +
                    "attribute vec3 normal;\r\n" +
                    "attribute vec2 uv;\r\n" +
                    "uniform mat4 worldViewProjection;\r\n" +
                    "varying vec3 vPosition;\r\n" +
                    "varying vec3 vNormal;\r\n" +
                    "varying vec2 vUV;\r\n" +

                    "void main(void) {\r\n" +
                    "    vec4 outPosition = worldViewProjection * vec4(position, 1.0);\r\n" +
                    "    gl_Position = outPosition;\r\n" +
                    "    vUV = uv;\r\n" +
                    "    vPosition = position;\r\n" +
                    "    vNormal = normal;\r\n" +
                    "}\r\n";

                BABYLON.Effect.ShadersStore["customFragmentShader"] =
                    "precision highp float;\r\n" +
                    "varying vec3 vPosition;\r\n" +
                    "varying vec3 vNormal;\r\n" +
                    "varying vec2 vUV;\r\n" +
                    "uniform mat4 world;\r\n" +
                    "uniform vec3 cameraPosition;\r\n" +

                    "uniform sampler2D map;\r\n" +
                    "uniform vec3 fogColor;\r\n" +
                    "uniform float fogNear;\r\n" +
                    "uniform float fogFar;\r\n" +
                    "void main() {\r\n" +
                    "    float depth = gl_FragCoord.z / gl_FragCoord.w;\r\n" +
                    "    float fogFactor = smoothstep( fogNear, fogFar, depth );\r\n" +
                    "    gl_FragColor = texture2D( map, vUV );\r\n" +
                    "    gl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );\r\n" +
                    "    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\r\n" +
                    "}\r\n";

                var positions = [];
                for (var i = 0; i < jsonstr.length; i += 3) {
                    positions.push(new BABYLON.Vector3(jsonstr[i], jsonstr[i + 2], jsonstr[i + 1]));
                }
                var positions2 = [];
                for (var i = 0; i < jsonstr.length; i += 3) {
                    positions2.push(new BABYLON.Vector3(jsonstr2[i], jsonstr2[i + 2], jsonstr2[i + 1]));
                }
                var thiz = this;
                var canvas = engine.getRenderingCanvas();
                engine.enableOfflineSupport = false;
                engine.setHardwareScalingLevel(0.5);
                var scene = new BABYLON.Scene(engine);

                var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);
                light.intensity = 1.2;
                var light1 = new BABYLON.HemisphericLight("Omni2", new BABYLON.Vector3(0, -1, 0), scene);
                light1.intensity = .5;
                var camera = new BABYLON.ArcRotateCamera("Camera", -Math.PI / 2, Math.PI / 2, 200, BABYLON.Vector3.Zero(), scene);
                camera.attachControl(canvas, false);
                camera.lowerRadiusLimit = 100;
                camera.upperRadiusLimit = 300;
                camera.minZ = 1.0;
                camera.layerMask = 0x20000000;

                var particleSystem1, particleSystem2;

                function RainFX(particleSystem, texturepath, minSize, maxSize, updateSpeed, num, maxEmitPower, mesh, length) {
                    particleSystem = new BABYLON.ParticleSystem("particles", num, scene);
                    particleSystem.particleTexture = new BABYLON.Texture(texturepath, scene);
                    var top = BABYLON.Mesh.CreatePlane("snowpanel", 50, scene);
                    // top.rotation = new BABYLON.Vector3(20 * Math.PI/180 + Math.PI / 2,Math.PI/2,Math.PI/2)
                    top.rotation.x = Math.PI / 2;
                    top.visibility = 0;
                    top.position = mesh.position;
                    particleSystem.emitter = top;
                    particleSystem.minEmitBox = new BABYLON.Vector3(-35, -20, 0);
                    particleSystem.maxEmitBox = new BABYLON.Vector3(length, 20, 0);
                    particleSystem.color1 = new BABYLON.Color4(1, 1, 1.0, 1.0);
                    particleSystem.color2 = new BABYLON.Color4(1, 1, 1.0, 1.0);
                    particleSystem.colorDead = new BABYLON.Color4(0, 0, 0.1, 0.0);
                    particleSystem.minSize = minSize;
                    particleSystem.maxSize = maxSize;
                    particleSystem.minLifeTime = 0.5;
                    particleSystem.maxLifeTime = 2.5;
                    particleSystem.direction1 = new BABYLON.Vector3(0, 1, 0);
                    particleSystem.direction2 = new BABYLON.Vector3(0, 1, 0);
                    particleSystem.emitRate = 2500;
                    particleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;
                    particleSystem.gravity = new BABYLON.Vector3(0, -9.81, 0);
                    particleSystem.minAngularSpeed = 0;
                    particleSystem.maxAngularSpeed = Math.PI / 2;
                    particleSystem.minEmitPower = 0.1;
                    particleSystem.maxEmitPower = maxEmitPower;
                    particleSystem.updateSpeed = updateSpeed;

                    function my_startDirectionFunction(emitPower, worldMatrix, directionToUpdate, particle) {
                        var randX = randomNumber(this.direction1.x, this.direction2.x);
                        var randY = randomNumber(this.direction1.y, this.direction2.y);
                        var randZ = randomNumber(this.direction1.z, this.direction2.z);
                        BABYLON.Vector3.TransformNormalFromFloatsToRef(randX * emitPower, randY * emitPower, randZ * emitPower, worldMatrix, directionToUpdate);
                    }

                    function my_startPositionFunction(worldMatrix, positionToUpdate, particle) {
                        var randX = randomNumber(this.minEmitBox.x, this.maxEmitBox.x);
                        var randY = randomNumber(this.minEmitBox.y, this.maxEmitBox.y);
                        var randZ = randomNumber(this.minEmitBox.z, this.maxEmitBox.z);
                        BABYLON.Vector3.TransformCoordinatesFromFloatsToRef(randX, randY, randZ, worldMatrix, positionToUpdate);
                    }

                    function my_updateFunction(particles) {
                        for (var index = 0; index < particles.length; index++) {
                            var particle = particles[index];
                            particle.age += this._scaledUpdateSpeed;
                            if (particle.age >= particle.lifeTime) {
                                this.recycleParticle(particle);
                                index--;
                                continue;
                            } else {
                                particle.colorStep.scaleToRef(this._scaledUpdateSpeed, this._scaledColorStep);
                                particle.color.addInPlace(this._scaledColorStep);
                                if (particle.color.a < 0) particle.color.a = 0;
                                particle.direction.scaleToRef(this._scaledUpdateSpeed, this._scaledDirection);
                                particle.position.addInPlace(this._scaledDirection);
                                this.gravity.scaleToRef(this._scaledUpdateSpeed, this._scaledGravity);
                                particle.direction.addInPlace(this._scaledGravity);
                            }
                        }
                    }

                    var randomNumber = function (min, max) {
                        if (min === max) {
                            return min;
                        }
                        var random = Math.random();
                        return random * (max - min) + min;
                    };
                    particleSystem.startDirectionFunction = my_startDirectionFunction;
                    particleSystem.startPositionFunction = my_startPositionFunction;
                    particleSystem.updateFunction = my_updateFunction;
                    particleSystem.start();
                    return particleSystem;
                }

                var cloud1 = new BABYLON.Mesh("", scene);
                cloud1.position = new BABYLON.Vector3(0, 12, 0);
                particleSystem1 = RainFX(particleSystem1, "./static/image/RainStreak.png", 1.5, 2.5, 0.04, 500, 0.3, cloud1, 20);
                particleSystem1.layerMask = 0x80000000;

                var cloud2 = new BABYLON.Mesh("", scene);
                cloud2.position = new BABYLON.Vector3(18, 7, 0);
                particleSystem2 = RainFX(particleSystem2, "./static/image/RainStreak.png", 1.5, 2.5, 0.04, 500, 0.3, cloud2, 5);
                particleSystem2.layerMask = 0x80000000;

                particleSystem1.stop();
                particleSystem2.stop();

                var out = new BABYLON.ShaderMaterial("shader", scene, {vertex: "custom", fragment: "custom",}, {
                    attributes: ["position", "normal", "uv"],
                    uniforms: ["world", "worldView", "worldViewProjection", "view", "projection"]
                    , needAlphaBlending: true
                });
                out.setTexture("map", new BABYLON.Texture("static/image/Cloud.png", scene));
                out.setVector3("fogColor", new BABYLON.Vector3(1, 1, 1));
                out.setFloat("fogNear", 1.8);
                out.setFloat("fogFar", 0.8);
                out.backFaceCulling = false;

                var group1 = new BABYLON.Mesh("", scene);
                var group2 = new BABYLON.Mesh("", scene);
                var planeone = BABYLON.Mesh.CreatePlane("ground1", 6, scene);
                planeone.material = out;
                planeone.layerMask = 0x20000000;
                for (var i = 0; i < positions.length; i += 2) {
                    var plane = planeone.clone("ss");
                    plane.position = positions[i];
                    var s = Math.random() * Math.random() * 1.5 + 2;
                    plane.scaling = new BABYLON.Vector3(s, s, s);
                    plane.visibility = true;
                    plane.setParent(group1);
                }
                for (var i = 0; i < positions2.length; i += 2) {
                    var plane = planeone.clone("ss");
                    plane.position = positions2[i];
                    var s = Math.random() * Math.random() * 1.5 + 2;
                    plane.scaling = new BABYLON.Vector3(s, s, s);
                    plane.visibility = false;
                    plane.setParent(group2);
                }
                planeone.dispose();

                var materialPlane = new BABYLON.StandardMaterial("texturePlane", scene);
                materialPlane.diffuseTexture = new BABYLON.Texture("static/image/dimian.jpg", scene);
                materialPlane.backFaceCulling = false;
                materialPlane.specularPower = 0;
                materialPlane.specularColor = new BABYLON.Color3(0, 0, 0);

                var materialArrowWarm = new BABYLON.StandardMaterial("texturePlane", scene);
                materialArrowWarm.diffuseColor = new BABYLON.Color3(1, 0, 0);
                materialArrowWarm.backFaceCulling = false;//Always show the front and the back of an element
                materialArrowWarm.specularPower = 0;
                materialArrowWarm.specularColor = new BABYLON.Color3(0, 0, 0);

                var materialArrowCold = new BABYLON.StandardMaterial("texturePlane", scene);
                materialArrowCold.diffuseColor = new BABYLON.Color3(0, 0, 0.5);
                materialArrowCold.backFaceCulling = false;//Always show the front and the back of an element
                materialArrowCold.specularPower = 0;
                materialArrowCold.specularColor = new BABYLON.Color3(0, 0, 0);

                var materialShan = new BABYLON.StandardMaterial("texturePlane", scene);
                materialShan.diffuseTexture = new BABYLON.Texture("static/image/shan.jpg", scene);
                materialShan.specularColor = new BABYLON.Color3(0, 0, 0);

              var materialFengMian = new BABYLON.StandardMaterial("texturePlane", scene);
              materialFengMian.diffuseColor = new BABYLON.Color3(0.5, 0.5, 0.5);
              materialFengMian.alpha =0.5;
              materialFengMian.backFaceCulling = true;//Always show the front and the back of an element
              materialFengMian.specularPower = 0;
              materialFengMian.specularColor = new BABYLON.Color3(0, 0, 0);

                var rainarea;
                var mesh1 = [];
                BABYLON.SceneLoader.ImportMesh("", "", "data:" + this.strData1, scene, function (newMeshes, particleSystems, skeletons) {
                    for (var i = 0; i < newMeshes.length; i++) {
                        newMeshes[i].isVisible = true;
                        newMeshes[i].layerMask = 0x20000000;
                        if (!newMeshes[i].rotationQuaternion) {
                            newMeshes[i].rotationQuaternion = BABYLON.Quaternion.RotationYawPitchRoll(newMeshes[i].rotation.y, newMeshes[i].rotation.x, newMeshes[i].rotation.z);
                            newMeshes[i].rotation = BABYLON.Vector3.Zero();
                            newMeshes[i].scaling = new BABYLON.Vector3(1, 1, 1);
                            newMeshes[i].position = BABYLON.Vector3.Zero();
                            mesh1.push(newMeshes[i]);
                            if (newMeshes[i].name == "zuobiaoA") {
                                newMeshes[i].material.backFaceCulling = false;
                            }else if (newMeshes[i].name == "fengmian") {
                              newMeshes[i].material=materialFengMian;

                            }else  if (newMeshes[i].name == "dimian") {
                              newMeshes[i].material=materialPlane;
                            }


                          // if (newMeshes[i].name == "dimian") {
                            // newMeshes[i].material=materialPlane;
                            // }else if (newMeshes[i].name == "warm") {
                            // newMeshes[i].material=materialArrowWarm;
                            // }else if (newMeshes[i].name == "cold") {
                            // newMeshes[i].material=materialArrowCold;
                            // }else if (newMeshes[i].name == "rain") {
                            // rainarea=newMeshes[i];
                            // rainarea.visibility=false;
                            // }

                        }
                    }
                });
                var mesh2 = [];
                BABYLON.SceneLoader.ImportMesh("", "", "data:" + this.strData2, scene, function (newMeshes, particleSystems, skeletons) {
                    for (var i = 0; i < newMeshes.length; i++) {
                        newMeshes[i].isVisible = true;
                        newMeshes[i].layerMask = 0x20000000;
                        if (!newMeshes[i].rotationQuaternion) {
                            newMeshes[i].rotationQuaternion = BABYLON.Quaternion.RotationYawPitchRoll(newMeshes[i].rotation.y, newMeshes[i].rotation.x, newMeshes[i].rotation.z);
                            newMeshes[i].rotation = BABYLON.Vector3.Zero();
                            newMeshes[i].scaling = new BABYLON.Vector3(1, 1, 1);
                            newMeshes[i].position = BABYLON.Vector3.Zero();
                            mesh2.push(newMeshes[i]);
                            if (newMeshes[i].name == "shan") {
                                newMeshes[i].material = materialShan;
                            } else if (newMeshes[i].name == "zuobiaoB") {
                                newMeshes[i].material.backFaceCulling = false;
                            }else if (newMeshes[i].name == "fengmian") {
                              newMeshes[i].material=materialFengMian;

                            }else  if (newMeshes[i].name == "dimian") {
                              newMeshes[i].material=materialPlane;
                            }

                            // if (newMeshes[i].name == "dimian") {
                            // newMeshes[i].material=materialPlane;
                            // }else if (newMeshes[i].name == "warm") {
                            // newMeshes[i].material=materialArrowWarm;
                            // }else if (newMeshes[i].name == "cold") {
                            // newMeshes[i].material=materialArrowCold;
                            // }else if (newMeshes[i].name == "rain") {
                            // rainarea=newMeshes[i];
                            // rainarea.visibility=false;
                            // }

                        }
                    }
                });

                initModel();

                function initModel() {
                    for (var i = 0; i < mesh1.length; i++) {
                        mesh1[i].visibility = true;
                        if (mesh1[i].name == "zhaozi") {
                            mesh1[i].visibility = false;
                        }
                    }
                    for (var i = 0; i < mesh2.length; i++) {
                        mesh2[i].visibility = false;
                    }
                }

                var index = 0;
                // Events
                var show1 = true;
                var show2 = true;
                var onPointerDown = function (evt) {
                    if(!evt.pointerId){
                        return;
                    }
                    var pickInfo = scene.pick(scene.pointerX, scene.pointerY);
                    if (pickInfo.hit) {
                        var currentMesh = pickInfo.pickedMesh;
                        console.log(currentMesh.name)
                        if (currentMesh.name == "zhaozi") {
                            if (index == 0) {
                                particleSystem2.stop();
                                particleSystem2.layerMask = 0x80000000;
                                if (show1 == true) {
                                    particleSystem1.start();
                                    particleSystem1.layerMask = 0x20000000;
                                } else {
                                    particleSystem1.stop();
                                    particleSystem1.layerMask = 0x80000000;
                                }
                                show1 = !show1;
                            } else if (index == 1) {
                                particleSystem1.stop();
                                particleSystem1.layerMask = 0x80000000;
                                if (show2 == true) {
                                    particleSystem2.start();
                                    particleSystem2.layerMask = 0x20000000;
                                } else {
                                    particleSystem2.stop();
                                    particleSystem2.layerMask = 0x80000000;
                                }
                                show2 = !show2;
                            }

                        }
                    }
                };


                thiz.canvas.addEventListener("pointerdown", onPointerDown, false);
                scene.onDispose = function () {
                    thiz.canvas.removeEventListener("pointerdown", onPointerDown);
                };

              var renderTimes=0;
                scene.registerBeforeRender(function () {
                  renderTimes++;
                  if(renderTimes%4!=0)return;
                    if (index == 0) {
                        for (var i = 0; i < group1.getChildMeshes().length; i++) {
                            group1.getChildren()[i].lookAt(camera.position);
                        }
                    } else {
                        for (var i = 0; i < group2.getChildMeshes().length; i++) {
                            group2.getChildren()[i].lookAt(camera.position);
                        }
                    }
                });
                var changeSence = function () {
                    var index = $(this).index();
                    if (index == 0 && thiz.cameraF) {
                        scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);
                    } else if (index == 1) {
                        scene.clearColor = new BABYLON.Color4(0.95, 0.95, 0.95, 1);
                    } else if (index == 2) {
                        scene.clearColor = new BABYLON.Color4(0.1, 0.1, 0.1, 1);
                    }
                }
                var swithBtn = function () {
                    $('#switchBtn>div').css('background', '#a9a9a9');
                    $(this).css('background', '#6a6a6a');
                    index = $(this).index();
                    if (index == 0) {
                        particleSystem1.stop();
                        particleSystem1.layerMask = 0x80000000;
                        particleSystem2.stop();
                        particleSystem2.layerMask = 0x80000000;
                        show1 = true;
                        show2 = true;
                        for (var i = 0; i < mesh1.length; i++) {
                            mesh1[i].visibility = true;
                            if (mesh1[i].name == "zhaozi") {
                                mesh1[i].visibility = false;
                            }
                        }
                        for (var i = 0; i < group1.getChildMeshes().length; i++) {
                            group1.getChildren()[i].visibility = true;
                        }
                        for (var i = 0; i < group2.getChildMeshes().length; i++) {
                            group2.getChildren()[i].visibility = false;
                        }
                        for (var i = 0; i < mesh2.length; i++) {
                            mesh2[i].visibility = false;
                        }
                    } else if (index == 1) {
                        particleSystem2.stop();
                        particleSystem1.layerMask = 0x80000000;
                        particleSystem1.stop();
                        particleSystem2.layerMask = 0x80000000;
                        show1 = true;
                        show2 = true;
                        for (var i = 0; i < mesh2.length; i++) {
                            mesh2[i].visibility = true;
                            if (mesh2[i].name == "zhaozi") {
                                mesh2[i].visibility = false;
                            }
                        }
                        for (var i = 0; i < mesh1.length; i++) {
                            mesh1[i].visibility = false;
                        }
                        for (var i = 0; i < group1.getChildMeshes().length; i++) {
                            group1.getChildren()[i].visibility = false;
                        }
                        for (var i = 0; i < group2.getChildMeshes().length; i++) {
                            group2.getChildren()[i].visibility = true;
                        }
                    }
                }
                var isMob = /iPad|Android/g.test(navigator.userAgent);
                if (isMob) {
                    $('#changeSence>div').on('touchstart', changeSence);
                    $('#switchBtn>div').on('touchstart', swithBtn);
                } else {
                    $('#changeSence>div').on('click', changeSence);
                    $('#switchBtn>div').on('click', swithBtn);
                }
                return scene;
            }
        },
        mounted() {
            this.init();
            $('#showhide').hide();
        }
    }
</script>

<style>
    html, body, h1, h2, h3, h4, h5, h6, hr, p, iframe, dl, dt, dd, ul, ol, li, pre, form, button, input, textarea, th, td, fieldset {
        margin: 0;
        padding: 0;
        border: none;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body, html {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        border: none;
        overflow: hidden;
        position: fixed;
        font-family: "Segoe WP", "Segoe UI", Verdana, Arial;
        touch-action: none;
        background-color: #fff;
        -ms-touch-action: none
    }

    body {
        height: 100%;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    canvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 9;
    }

    #video {
        position: absolute;
        left: 0;
        right: 0;
        margin: auto;
        z-index: 1;
        background: #fff;
    }

    #video.videoW {
        height: auto;
        width: 100%;
    }

    #video.videoH {
        width: auto;
        height: 100%;
    }

    .wxtip {
        text-align: center;
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        z-index: 998;
        display: none;
        background-size: 70% auto;
        background-position: top right;
        background-repeat: no-repeat;
        background-color: rgba(0, 0, 0, 0.6);
    }

    /****** 基本样式开始 ******/

    #fps {
        position: absolute;
        right: 20px;
        top: 5em;
        font-size: 20px;
        color: #6cf;
        z-index: 997;
    }

    .renderCanvas-container {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
    }

    #notSupported {
        color: #232F32;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        background-color: #ffffff;
        text-align: center;
        padding-top: 0;
        font-size: 30px;
        z-index: 999;
        cursor: default
    }

    #renderCanvas {
        width: 100%;
        height: 100%;
        outline: 0
    }

    .hidden {
        display: none
    }

    #changeSence {
        width: 50px;
        position: absolute;
        z-index: 19;
        left: 15px;
        bottom: 0px;
        top: 0px;
        margin: auto;
    }

    #changeSence > div {
        margin: 12px 0;
        width: 50px;
        height: 50px;
        cursor: pointer;
        border-radius: 50%;
        box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.5);
    }

    #changeSence > div > img {
        width: 50px;
    }

    #switchBtn {
        width: 182px;
        position: absolute;
        z-index: 19;
        right: 15px;
        bottom: 15px;
    }

    #switchBtn > div {
        color: #fff;
        width: 180px;
        height: 34px;
        font-weight: 500;
        line-height: 30px;
        text-align: center;
        background: #a9a9a9;
        border: 2px solid #c5c5c5;
        border-radius: 6px;
        cursor: pointer;
        margin: 12px 0;
        box-shadow: 0px 0px 1px rgba(0, 0, 0, 0.8);
    }

    @media (max-width: 720px) {
        #title {
            font-size: 22px;
        }

        #check div,
        #step div {
            font-size: 13px;
        }

        #step > div > div {
            padding-left: 38px;
        }

        #step div > span {
            left: 8px;
        }
    }

    @media (max-width: 655px) {
        #title {
            font-size: 20px;
        }

        #check div,
        #step div {
            font-size: 12px;
        }

        #step > div > div {
            padding-left: 32px;
        }

        #step div > span {
            left: 5px;
        }

    }
</style>
